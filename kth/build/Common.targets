<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="GetKnuthCAPI">
    <Exec Command="conan remote list" ConsoleToMSBuild="true">
      <Output TaskParameter="ConsoleOutput" PropertyName="ConanRemoteList" />
    </Exec>
    <Exec Command="conan remote update kthbuild_kth_temp_ https://api.bintray.com/conan/k-nuth/kth" Condition="$(ConanRemoteList.Contains('kthbuild_kth_temp_'))" ContinueOnError="WarnAndContinue" />
    <Exec Command="conan remote add kthbuild_kth_temp_ https://api.bintray.com/conan/k-nuth/kth" Condition=" ! $(ConanRemoteList.Contains('kthbuild_kth_temp_'))" ContinueOnError="WarnAndContinue" />
    
    <Message Text="Conan Channel:  $(CONAN_CHANNEL)"/>
    <Message Text="Conan Version:  $(CONAN_VERSION)"/>
    <Message Text="Conan Currency: $(CONAN_CURRENCY)"/>
    <Message Text="Conan Keoken:   $(CONAN_KEOKEN)"/>
    <Message Text="Conan March ID: $(CONAN_MARCH_ID)"/>
    
    <WriteLinesToFile
      File="conanfile.txt" Lines="[requires];c-api/$(CONAN_VERSION)@kth/$(CONAN_CHANNEL);[generators];cmake;[options];c-api:shared=True;c-api:currency=$(CONAN_CURRENCY);c-api:keoken=$(CONAN_KEOKEN);c-api:db=full;c-api:march_id=$(CONAN_MARCH_ID);[imports];bin, *.dll    -> .;lib, *.so    -> .;lib, *.dylib    -> ."
      Overwrite="true"/>

    <Message Text="Operating System: $(OS)"/>
    <Exec Command="conan install . --install-folder=. -r kthbuild_kth_temp_" Condition=" '$(OS)' != 'Windows_NT' " />
    <Exec Command="conan install . --install-folder=. -r kthbuild_kth_temp_ -s compiler=&quot;Visual Studio&quot; -s compiler.version=16" Condition=" '$(OS)' == 'Windows_NT' "/>
    <Message Text="OS = $(OS)" />
    <Copy SourceFiles="kth-c-api.dll" DestinationFiles="$(OutDir)libkth-c-api.dll" Condition=" '$(OS)' == 'Windows_NT' "/>
    <Copy SourceFiles="libkth-c-api.so" DestinationFiles="$(OutDir)libkth-c-api.so" Condition="Exists('libkth-c-api.so')"/>
    <Copy SourceFiles="libkth-c-api.dylib" DestinationFiles="$(OutDir)libkth-c-api.dylib" Condition="Exists('libkth-c-api.dylib')"/>
  </Target>
</Project>